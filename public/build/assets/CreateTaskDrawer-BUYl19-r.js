import{X as D,r as v,j as t,b as u,a as S}from"./app-CQeDVQuS.js";import{o as k}from"./ConfirmModal-6SBIjGeE.js";import{c as p,D as C,a as T}from"./TaskDrawer.module-gYPyq8ht.js";import{R as w}from"./RichTextEditor-DmZzE8jx.js";import{u as y}from"./useTaskDrawerStore-Cjnssq_l.js";import{u as F}from"./useForm-p-9YiRut.js";import P from"./LabelsDropdown-CCt45Yav.js";import{P as g}from"./enums-C8PG_d5N.js";import{D as A}from"./Drawer-CB6fJYQ0.js";import{T as M}from"./TextInput-DWJ4iefM.js";import{M as N}from"./MultiSelect-BTwgAEuD.js";import{F as E}from"./Flex-BgjLIV7l.js";import{S as b}from"./Select-We5hmp_A.js";import{T as Y}from"./Text-C7Ogcti-.js";import"./file-D4aCAaTQ.js";import"./upper-first-sQkIoMXG.js";import"./use-resolved-styles-api-BXRJnP4G.js";import"./use-disclosure-CHrwo5eQ.js";import"./IconCircleX-D9_CrJfg.js";import"./createReactComponent-Z0-s2Pq0.js";import"./Image-CJlMvM6Z.js";import"./Center-Bqx9e1q2.js";import"./IconX-C26Eg-cJ.js";import"./SimpleGrid-D5dBYODQ.js";import"./get-sorted-breakpoints-iwMx6bI5.js";import"./get-base-value-JqT_q0U7.js";import"./pick-calendar-levels-props-DZFF4eOP.js";import"./use-uncontrolled-DDoK6Wjp.js";import"./AccordionChevron-3X1F-jkk.js";import"./clamp-DTmYCdls.js";import"./InputBase-BmeHhBbi.js";import"./Input-BpqpINKS.js";import"./Popover-CRA-5r7S.js";import"./use-floating-auto-update-DtQKRGxQ.js";import"./noop-BjFrJKj1.js";import"./use-computed-color-scheme-DWNI3ZFj.js";import"./Tooltip-W_kFrwwB.js";import"./get-style-object-DUJZA7T_.js";import"./ColorSwatch-MAR8_92F.js";import"./ColorPicker-CNOY2v1Y.js";import"./ActionIcon-CLNruuHn.js";import"./route-DnWyDX0p.js";import"./_baseClone-CRHU6voy.js";import"./with-selector-Dx34AVcc.js";import"./index-DSj5ND_Q.js";import"./index-CdE3aVqV.js";import"./Label-B85Huc9I.js";import"./Combobox-CG5rkmIX.js";import"./PillsInput-BdX_zTjY.js";import"./Pill-tisBWBts.js";import"./CheckIcon-D3YounCa.js";import"./OptionsDropdown-D2SabLis.js";function Ee(){const{create:o,closeCreateTask:l}=y(),{usersWithAccessToProject:d,taskGroups:h,labels:f,project:s,currency:i,auth:{user:_}}=D().props,n={group_id:o.group_id?o.group_id.toString():"",assigned_to_user_id:"",name:"",description:"",pricing_type:(s==null?void 0:s.default_pricing_type)||g.HOURLY,estimation:"",fixed_price:"",due_on:"",hidden_from_clients:!1,billable:!0,subscribed_users:[_.id.toString()],labels:[],attachments:[]},[r,x,a]=F("post",route("projects.tasks.store",[route().params.project]),{...n});v.useEffect(()=>{a({...n})},[o.opened]);const m=(e=!1)=>{e||JSON.stringify(r.data)===JSON.stringify(n)&&!r.processing?l():k({type:"danger",title:"Discard changes?",content:"All unsaved changes will be lost.",confirmLabel:"Discard",confirmProps:{color:"red"},onConfirm:()=>l()})},j=e=>{const c=[...r.data.attachments];c.splice(e,1),a("attachments",c)};return r.data.pricing_type,g.FIXED,i!=null&&i.symbol,t.jsx(A,{opened:o.opened,onClose:m,title:t.jsx(Y,{fz:S(28),fw:600,ml:25,my:"sm",children:"Add new task"}),position:"right",size:1e3,overlayProps:{backgroundOpacity:.55,blur:3},transitionProps:{transition:"slide-left",duration:400,timingFunction:"ease"},children:t.jsxs("form",{onSubmit:e=>x(e,{onSuccess:()=>m(!0),forceFormData:!0}),className:p.inner,children:[t.jsxs("div",{className:p.content,children:[t.jsx(M,{label:"Name",placeholder:"Task name",required:!0,"data-autofocus":!0,value:r.data.name,onChange:e=>a("name",e.target.value),error:r.errors.name}),t.jsx(w,{mt:"xl",placeholder:"Task description",height:260,onChange:e=>a("description",e)}),t.jsx(C,{mt:"xl",selected:r.data.attachments,onChange:e=>a("attachments",e),remove:e=>j(e)}),t.jsx(N,{label:"Subscribers",placeholder:"Select subscribers",searchable:!0,mt:"md",value:r.data.subscribed_users,onChange:e=>a("subscribed_users",e),data:d.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.subscribed_users}),t.jsxs(E,{justify:"space-between",mt:"xl",children:[t.jsx(u,{variant:"transparent",w:100,disabled:r.processing,onClick:m,children:"Cancel"}),t.jsx(u,{type:"submit",w:120,loading:r.processing,children:"Add task"})]})]}),t.jsxs("div",{className:p.sidebar,children:[t.jsx(b,{label:"Task group",placeholder:"Select task group",required:!0,value:r.data.group_id,onChange:e=>a("group_id",e),data:h.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.group_id}),t.jsx(b,{label:"Assignee",placeholder:"Select assignee",searchable:!0,mt:"md",value:r.data.assigned_to_user_id,onChange:e=>a("assigned_to_user_id",e),data:d.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.assigned_to_user_id}),t.jsx(T,{clearable:!0,valueFormat:"DD MMM YYYY",minDate:new Date,mt:"md",label:"Due date",placeholder:"Pick task due date",value:r.data.due_on,onChange:e=>a("due_on",e)}),t.jsx(P,{items:f,selected:r.data.labels,onChange:e=>a("labels",e),mt:"md"})]})]})})}export{Ee as CreateTaskDrawer};
