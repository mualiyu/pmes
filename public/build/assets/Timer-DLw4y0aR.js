import{r as o,J as b,X as R,j as e,B as S,G as h,a as p,x as N}from"./app-CQeDVQuS.js";import{h as w,u as P,i as T}from"./useTasksStore-DWoe4t5E.js";import{c as k}from"./datetime-BgfhEWkv.js";import{S as g}from"./Stack-DnbdV9Zg.js";import{A as j}from"./ActionIcon-CLNruuHn.js";import{c as v}from"./createReactComponent-Z0-s2Pq0.js";import{T as C}from"./TextInput-DWJ4iefM.js";import{I as E}from"./IconPlus-BFuYsGRM.js";import{T as f}from"./Text-C7Ogcti-.js";import{I as V}from"./IconX-C26Eg-cJ.js";import{T as F}from"./Tooltip-W_kFrwwB.js";import{D as M}from"./Divider-Bi6N1q_X.js";import"./with-selector-Dx34AVcc.js";import"./reorder-Cl5rjXcS.js";import"./_baseClone-CRHU6voy.js";import"./index-DSj5ND_Q.js";import"./InputBase-BmeHhBbi.js";import"./Input-BpqpINKS.js";import"./use-resolved-styles-api-BXRJnP4G.js";import"./use-floating-auto-update-DtQKRGxQ.js";import"./get-style-object-DUJZA7T_.js";function A(s,d,{autoInvoke:u=!1}={}){const[n,c]=o.useState(!1),r=o.useRef(null),m=o.useRef(null),l=()=>{c(_=>(!_&&(!r.current||r.current===-1)&&(r.current=window.setInterval(m.current,d)),!0))},t=()=>{c(!1),window.clearInterval(r.current||-1),r.current=-1},x=()=>{n?t():l()};return o.useEffect(()=>(m.current=s,n&&l(),t),[s,n,d]),o.useEffect(()=>{u&&l()},[]),{start:l,stop:t,toggle:x,active:n}}/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var $=v("filled","player-play-filled","IconPlayerPlayFilled",[["path",{d:"M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var D=v("filled","player-stop-filled","IconPlayerStopFilled",[["path",{d:"M17 4h-10a3 3 0 0 0 -3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3 -3v-10a3 3 0 0 0 -3 -3z",key:"svg-0"}]]);function B(s){const[d,u]=o.useState(""),n=t=>t.minutes===null&&t.timer_start!==null,[c,r]=o.useState(s.time_logs.find(t=>n(t))),m=()=>{if(c){const t=Math.round((b().unix()-c.timer_start)/60);u(w(t))}},l=A(m,1e3);return o.useEffect(()=>{const t=s.time_logs.find(x=>n(x));return r(t),t?(m(),l.start()):(u(""),l.stop()),l.stop},[s.time_logs,c]),{timerValue:d,setTimerValue:u,isTimerRunning:n,runningTimer:c}}const G="_container_1xolz_1",X="_timer_1xolz_14",J="_input_1xolz_24",O="_invalid_1xolz_33",q="_list_1xolz_38",H="_row_1xolz_50",K="_summary_1xolz_67",Q="_blink_1xolz_72",a={container:G,timer:X,input:J,invalid:O,list:q,row:H,delete:"_delete_1xolz_52",summary:K,blink:Q};function he({task:s,...d}){const{auth:{user:u}}=R().props,[n,c]=o.useState(0),{timerValue:r,setTimerValue:m,isTimerRunning:l,runningTimer:t}=B(s),{saveTimeLog:x,deleteTimerLog:_,startTimer:y,stopTimer:z}=P();return o.useEffect(()=>{c(s.time_logs.reduce((i,I)=>i+I.minutes,0)),m("")},[s.time_logs]),e.jsx(S,{className:a.container,...d,children:e.jsxs(g,{children:[can("add time log")?e.jsxs(h,{className:a.timer,justify:"space-between",wrap:"nowrap",children:[t?e.jsx(j,{size:32,radius:"xl",variant:"filled",onClick:()=>z(s,t.id),children:e.jsx(D,{style:{width:p(16),height:p(16)}})}):e.jsx(j,{size:32,radius:"xl",variant:"filled",onClick:()=>y(s),children:e.jsx($,{style:{width:p(16),height:p(16)}})}),e.jsx(h,{wrap:"nowrap",gap:5,children:e.jsx(C,{variant:"unstyled",size:"sm",placeholder:"0:00",readOnly:t!==void 0,className:`
                  ${a.input}
                  ${t?a.blink:null}
                  ${T(r)?null:r.length&&a.invalid}
                `,value:r,onChange:i=>{/^(\d|\.|,|:)*$/.test(i.currentTarget.value)&&m(i.currentTarget.value)}})}),e.jsx(j,{size:32,radius:"xl",variant:"filled",onClick:()=>x(s,r),disabled:!T(r)||t,children:e.jsx(E,{style:{width:p(16),height:p(16)},stroke:3})})]}):e.jsx(f,{ml:10,fz:15,fw:500,children:"Time logs"}),s.time_logs.length>0&&can("view time logs")&&e.jsxs(e.Fragment,{children:[e.jsx(g,{className:a.list,gap:5,children:s.time_logs.map(i=>e.jsxs(h,{wrap:"nowrap",justify:"space-between",className:a.row,children:[e.jsx(f,{fz:14,children:e.jsx(N,{href:route("users.edit",i.user_id),children:i.user.name})}),l(i)?e.jsx(f,{fz:14,fw:600,c:"blue",className:a.blink,children:"running"}):e.jsxs(h,{gap:7,children:[can("delete time log")&&i.user_id===u.id&&e.jsx(V,{className:a.delete,stroke:1.5,onClick:()=>_(s,i.id)}),e.jsx(F,{label:k(i.created_at),openDelay:250,withArrow:!0,children:e.jsxs(f,{fz:14,c:"dimmed",children:[w(i.minutes),"h"]})})]})]},i.id))}),e.jsx(M,{my:-5}),e.jsxs(h,{wrap:"nowrap",justify:"space-between",className:a.summary,children:[e.jsx(f,{fz:15,fw:500,children:"Total:"}),e.jsxs(f,{fw:600,children:[w(n),"h"]})]})]})]})})}export{he as default};
